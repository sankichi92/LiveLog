create_table :active_storage_attachments, force: :cascade do |t|
  t.string :name, null: false
  t.string :record_type, null: false
  t.bigint :record_id, null: false
  t.bigint :blob_id, null: false

  t.datetime :created_at, null: false

  t.index :blob_id
  t.index %i[record_type record_id name blob_id], name: 'index_active_storage_attachments_uniqueness', unique: true
end

create_table :active_storage_blobs, force: :cascade do |t|
  t.string :key, null: false
  t.string :filename, null: false
  t.string :content_type
  t.text :metadata
  t.bigint :byte_size, null: false
  t.string :checksum, null: false

  t.datetime :created_at, null: false

  t.index :key, unique: true
end

create_table :lives, id: :serial, force: :cascade do |t|
  t.string :name, null: false
  t.date :date, null: false
  t.string :place
  t.string :album_url
  t.datetime :published_at
  t.boolean :published, default: false, null: false

  t.timestamps

  t.index %i[date name], unique: true
end

create_table :members, force: :cascade do |t|
  t.bigint :user_id
  t.integer :joined_year, null: false, limit: 2
  t.string :first_name, null: false
  t.string :last_name, null: false
  t.string :furigana, null: false
  t.string :nickname
  t.string :url
  t.string :bio

  t.timestamps

  t.index :user_id, unique: true
  t.index %i[joined_year furigana], order: { joined_year: :desc, furigana: :asc }
end

create_table :playings, id: :serial, force: :cascade do |t|
  t.integer :user_id, null: false
  t.integer :song_id, null: false
  t.string :inst

  t.timestamps

  t.index :song_id
  t.index %i[user_id song_id], unique: true
end

create_table :songs, id: :serial, force: :cascade do |t|
  t.string :name, null: false
  t.string :artist
  t.string :youtube_id
  t.integer :live_id, null: false
  t.integer :order
  t.time :time
  t.integer :status, default: 1
  t.text :comment
  t.boolean :original, default: false, null: false

  t.timestamps

  t.index :live_id
end

create_table :users, id: :serial, force: :cascade do |t|
  t.string :first_name, null: false
  t.string :last_name, null: false
  t.string :furigana, null: false
  t.string :nickname
  t.string :email
  t.integer :joined, null: false
  t.string :password_digest
  t.string :remember_digest
  t.boolean :admin, default: false, null: false
  t.string :activation_digest
  t.boolean :activated, default: false, null: false
  t.datetime :activated_at
  t.string :reset_digest
  t.datetime :reset_sent_at
  t.boolean :public, default: false, null: false
  t.string :url
  t.text :intro
  t.boolean :subscribing, default: true, null: false
  t.integer :playings_count, default: 0, null: false

  t.timestamps

  t.index :email, unique: true
  t.index :furigana
end

add_foreign_key :active_storage_attachments, :active_storage_blobs, column: :blob_id
add_foreign_key :members, :users
add_foreign_key :playings, :songs
add_foreign_key :playings, :users
add_foreign_key :songs, :lives, column: :live_id

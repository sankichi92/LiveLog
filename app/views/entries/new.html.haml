- provide(:title, '新規エントリー')

= form_with model: @entry, local: true do |form|
  = render 'shared/error_messages', errors: @entry.errors

  = fields model: @entry.song do |song_form|
    .form-group
      = song_form.label :live_id
      = song_form.collection_select :live_id, Live.unpublished.newest_order, :id, :title, {}, class: 'form-control'

    .form-group
      = song_form.label :name
      = song_form.text_field :name, required: true, class: 'form-control'

    .form-group
      = song_form.label :artist
      = song_form.text_field :artist, class: 'form-control', list: 'artists'
      %datalist#artists
        - Song.artists_for_suggestion.each do |artist|
          %option{ value: artist }

    .form-check.mb-3
      = song_form.check_box :original, class: 'form-check-input'
      = song_form.label :original, class: 'form-check-label'
      %small.form-text.text-muted 京大アンプラグドのメンバーが作詞・作曲した曲の場合にチェックしてください

    .form-group
      = song_form.label :status
      = song_form.select :status, { '公開': 'open', 'サークル内': 'closed', 'バンド内': 'secret' }, { selected: 'open' }, class: 'form-control'
      %small.form-text.text-muted 動画・音源の公開範囲です。「公開」は全てのユーザ、「サークル内」はログインユーザのみ、「バンド内」は演者のみに公開されます

    %div.mb-3{ data: { controller: 'form-plays' } }
      %template{ data: { target: 'form-plays.template' } }
        = song_form.fields_for :plays, Play.new, child_index: 'TEMPLATE_INDEX' do |plays_form|
          = render 'form_play', form: plays_form

      = song_form.fields_for :plays do |plays_form|
        = render 'form_play', form: plays_form

      %button.btn.btn-light{ type: 'button', data: { action: 'form-plays#addPlay' } }= icon('fas', 'plus-circle', '演者を追加する')

  %div.mb-3{ data: { controller: 'form-available-times' } }
    %template{ data: { target: 'form-available-times.template' } }
      = form.fields_for :available_times, AvailableTime.new, child_index: 'TEMPLATE_INDEX' do |available_times_form|
        = render 'form_available_time', form: available_times_form

    = form.fields_for :available_times do |available_times_form|
      = render 'form_available_time', form: available_times_form

    %button.btn.btn-light{ type: 'button', data: { action: 'form-available-times#addAvailableTime' } }= icon('fas', 'plus-circle', '演奏可能時間を追加する')

  %datalist#instruments
    - Play.instruments_for_suggestion.each do |instrument|
      %option{ value: instrument }

  .form-group
    = form.label :notes
    = form.text_area :notes, class: 'form-control'

  = form.submit class: 'btn btn-primary'

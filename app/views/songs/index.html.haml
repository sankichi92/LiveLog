- provide(:title, 'Song Search')
- provide(:description, "京大アンプラグドで演奏された曲の「#{params[:q]}」の検索結果") if params[:q].present?
%header.page-header
  %h1.display-4 Song Search

%ul#search-tabs.nav.nav-pills.mb-3{ role: 'tablist' }
  - advanced = current_page?(search_songs_path) && params[:q].nil?
  %li.nav-item
    %a#basic-tab.nav-item.nav-link{ class: advanced ? '' : 'active', 'data-toggle': 'pill', href: '#basic', role: 'tab', 'aria-controls': 'basic', 'aria-selected': !advanced }
      Basic
  %li.nav-item
    %a#advanced-tab.nav-item.nav-link{ class: advanced ? 'active' : '', 'data-toggle': 'pill', href: '#advanced', role: 'tab', 'aria-controls': 'advanced', 'aria-selected': advanced }
      Advanced

#search-tabs-content.tab-content
  #basic.tab-pane.fade{ class: advanced ? '' : 'show active', role: 'tabpanel', 'aria-labelledby': 'basic-tab' }
    = render 'search_form'
  #advanced.tab-pane.fade{ class: advanced ? 'show active' : '', role: 'tabpanel', 'aria-labelledby': 'advanced-tab' }
    = form_with model: @query, scope: '', url: search_songs_path, method: :get, local: true, class: 'mb-3' do |f|

      .form-row
        .form-group.col-sm
          = f.label :name, class: 'col-form-label'
          = f.text_field :name, id: 'name', class: 'form-control', placeholder: '楓'
        .form-group.col-sm
          = f.label :artist, class: 'col-form-label'
          = f.text_field :artist, id: 'artist', class: 'form-control', placeholder: 'スピッツ', list: 'artists'
          %datalist#artists
            - Song.artists_for_suggestion.each do |artist|
              %option{ value: artist }

      .form-row
        .form-group.col-sm
          = f.label :instruments, class: 'col-form-label'
          = f.text_field :instruments, id: 'instruments', class: 'form-control', placeholder: 'Vo Gt Ba Cj -Vn'
        .form-group.col-sm
          = f.label :players_count, class: 'col-form-label'
          .input-group
            = f.number_field :players_lower, class: 'form-control col', placeholder: '4'
            .input-group-append.input-group-prepend
              %span.input-group-text 〜
            = f.number_field :players_upper, class: 'form-control col', placeholder: '6'

      .form-group
        = f.label :date
        .input-group
          = f.date_field :date_lower, value: params[:date_lower], class: 'form-control'
          .input-group-append.input-group-prepend
            %span.input-group-text 〜
          = f.date_field :date_upper, value: params[:date_upper], class: 'form-control'

      .custom-control.custom-checkbox.mb-2
        = f.check_box :original, id: 'original', class: 'custom-control-input'
        = f.label :original, class: 'custom-control-label'

      .custom-control.custom-checkbox.mb-3
        = f.check_box :video, id: 'video', class: 'custom-control-input'
        = f.label :video, class: 'custom-control-label'

      = f.submit t('views.application.search'), class: 'btn btn-primary'

- if @songs.present?
  #results
    %p.text-right
      = page_entries_info
    .song-list.mb-3
      - @songs.each do |song|
        - cache_unless logged_in?, song do
          = render song
    = will_paginate inner_window: 1, outer_window: 0, renderer: WillPaginate::ActionView::Bootstrap4LinkRenderer

- else
  .alert.alert-danger{ role: 'alert' }
    = t('views.songs.no_results')
